<% content_for :peer_js do %>
    <%= javascript_include_tag "http://cdn.peerjs.com/0.3/peer.js" %>
<% end %>
<script>
  <% if current_user == @videochat.user %>
    peer.on('open', function(){
    $.post('/set_host_peer_id', 
      {videochat_id: <%= @videochat.id %>, host_peer_id: peer.id, authenticity_token: AUTH_TOKEN}, 
      function(data) {});
    });
  <% end %>
</script>
<%= render "home/navbar" %>
<div class="spec container">
  <div class="pure-g">
    <h1>Chatroom: <b><%=@videochat.title%></b></h1>
    <!-- Get local audio/video stream -->
    <div id="step1">
      <div id="step1-error">
        <h4 style="color:red;"><b>Failed to access the webcam and microphone. Make sure to click allow when asked for permission by the browser.</b></h4>
        <a href="#" class="pure-button pure-button-error" id="step1-retry">Try again</a>
      </div>
    </div>

    <!-- Call in progress -->
    <div id="step2">
      <p><a href="#" class="btn btn-warning" id="end-call">End call</a></p>
    </div>

        <!-- Video area -->
        <div class="videochatwindows" id="video-container"><br/>
          <video id="their-video" autoplay></video>
          <video id="my-video" muted="true" autoplay></video>
        </div>

    </div>
</div>
